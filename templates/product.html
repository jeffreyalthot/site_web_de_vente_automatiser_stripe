{% extends 'base.html' %}
{% block content %}
<a class="back-link" href="{{ url_for('index', tab=request.args.get('tab', 'catalogue')) }}">← Retour</a>
<section class="product-detail">
  <div class="product-media">
    {% set image_src = product['image_url'] %}
    {% if image_src and not image_src.startswith('http') %}
      {% set image_src = url_for('static', filename=image_src) %}
    {% endif %}
    <img src="{{ image_src or 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?auto=format&fit=crop&w=800&q=80' }}" alt="{{ product['name'] }}">
    {% if images %}
      <div class="product-gallery">
        {% for image in images %}
          <img src="{{ url_for('static', filename=image['image_url']) }}" alt="{{ product['name'] }} image {{ loop.index }}">
        {% endfor %}
      </div>
    {% endif %}
  </div>
  <div class="product-description">
    <span class="tag">{{ product['category'] }}</span>
    <h1>{{ product['name'] }}</h1>
    <p>{{ product['description'] or 'Un produit sélectionné pour sublimer votre quotidien.' }}</p>
    <div class="product-meta">
      <span>Stock: {{ product['stock'] }}</span>
      <span>Couleur: {{ product['color'] or '—' }}</span>
      <span>Taille: {{ product['size'] or '—' }}</span>
    </div>
    <div class="price">${{ '%.2f'|format(product['price']) }}</div>
    <form method="post" action="{{ url_for('add_to_cart', product_id=product['id']) }}">
      <label>Quantité</label>
      <input type="number" name="quantity" min="1" max="{{ product['stock'] }}" value="1">
      <button class="cta" type="submit">Ajouter au panier</button>
    </form>
  </div>
</section>
{% endblock %}
