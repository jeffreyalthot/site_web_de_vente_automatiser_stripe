{% extends 'base.html' %}
{% block content %}
<section class="dashboard">
  <h1>Panel Administrateur</h1>
  <div class="stats-grid">
    <div class="stat-card">
      <h4>Ventes semaine</h4>
      <p>${{ '%.2f'|format(weekly_total) }}</p>
    </div>
    <div class="stat-card">
      <h4>Ventes mois</h4>
      <p>${{ '%.2f'|format(monthly_total) }}</p>
    </div>
    <div class="stat-card">
      <h4>Ventes année</h4>
      <p>${{ '%.2f'|format(yearly_total) }}</p>
    </div>
    <div class="stat-card">
      <h4>Moyenne/jour (30j)</h4>
      <p>${{ '%.2f'|format(avg_daily) }}</p>
    </div>
  </div>
</section>

<section class="admin-section">
  <div class="admin-card add-card">
    <h2>Ajouter un article</h2>
    <a class="add-product-btn" href="{{ url_for('admin_new_product') }}">
      <span>+</span>
    </a>
    <p>Ouvrir le formulaire pour créer un nouvel article.</p>
  </div>

  <div class="admin-card">
    <h2>Stock & Prix</h2>
    {% if products %}
      <div class="stock-list">
        {% for product in products %}
          <div class="stock-row">
            <form class="stock-item" method="post" action="{{ url_for('admin_update_stock', product_id=product['id']) }}">
              <div>
                <h4>{{ product['name'] }}</h4>
                <p>{{ product['category'] }}</p>
                <p class="muted">Couleur : {{ product['color'] or '—' }} | Taille : {{ product['size'] or '—' }}</p>
                <p class="muted">Statut : {{ 'En vente' if product['listed'] else 'Hors vente' }}</p>
              </div>
              <input type="number" name="stock" value="{{ product['stock'] }}" min="0">
              <input type="number" step="0.01" name="price" value="{{ product['price'] }}">
              <button class="ghost" type="submit">Mettre à jour</button>
            </form>
            <form class="listing-item" method="post" action="{{ url_for('admin_toggle_listing', product_id=product['id']) }}">
              <button class="cta" type="submit">{{ 'Retirer' if product['listed'] else 'Lister' }}</button>
            </form>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p>Aucun article pour le moment.</p>
    {% endif %}
  </div>
</section>

<section class="admin-section">
  <div class="admin-card full">
    <h2>Commandes en cours</h2>
    {% if orders %}
      <div class="orders-table">
        <div class="orders-header">
          <span>Client</span>
          <span>Adresse</span>
          <span>Montant</span>
          <span>Stripe</span>
          <span>Date</span>
        </div>
        {% for order in orders %}
          <div class="orders-row">
            <span>{{ order['customer_name'] }}</span>
            <span>{{ order['customer_address'] }}</span>
            <span>${{ '%.2f'|format(order['total']) }}</span>
            <span>{{ order['stripe_payment_id'] }}</span>
            <span>{{ order['created_at'][:10] }}</span>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p>Aucune commande payée.</p>
    {% endif %}
  </div>
</section>
{% endblock %}
